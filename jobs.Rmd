---
title: "Data Related jobs"
author: "Khuong Le & Shiyong Liu"
date: July 23, 2018
---

Load different packages that will use in this model:

```{r}
pkg_list = c("ggplot2", "plyr", "stringr")
mia_pkgs = pkg_list[!(pkg_list %in% installed.packages()[,"Package"])]
if(length(mia_pkgs) > 0) install.packages(mia_pkgs)
loaded_pkgs = lapply(pkg_list, require, character.only=TRUE)
```

Set up the data:

```{r}
jdata = read.csv("datarelatedjobs.csv")
names(jdata)
head(jdata)
```

Overiew about our dataset:

```{r}
summary(jdata)
str(data)
```

1. Comparing between companies in the North and the South of California (using side-by-side histogram):

- Number of companies in North vs South
- Average minimum experience. 
- Number of Bachelor's, Master's, Ph.D that companies recruiting in North vs South. (All levels = add 1 to every value)
- Average salary in North vs South

Data transformation:

Minimum experience

```{r}
for(i in 1:length(jdata$Minimum_exp_years)){
  if(jdata$Minimum_exp_years[i] == 1 & !is.na(jdata$Estimate_minimum_average_salary[i])){
    if(jdata$Estimate_minimum_average_salary[i] >= 150000){
      jdata$Minimum_exp_years[i] = 4
    }
    else if(jdata$Estimate_minimum_average_salary[i] >= 130000 &
            jdata$Estimate_minimum_average_salary[i] <  150000){
      jdata$Minimum_exp_years[i] = 3
    }
    else if (jdata$Estimate_minimum_average_salary[i] >= 100000 &
             jdata$Estimate_minimum_average_salary[i] <  130000){
      jdata$Minimum_exp_years[i] = 2
    }
    else{jdata$Minimum_exp_years[i] = 1}
  } 
}
```

Add variable names: Jobs density to show which city offers lots of position, which city offers less position.

```{r}
for (i in 1:length(jdata$City))
if(count(jdata$City)$freq[which(count(jdata$City)$x == (jdata$City[i]))] > 25){ 
  jdata$Jobs_density[i] = "High"
} else if(count(jdata$City)$freq[which(count(jdata$City)$x == (jdata$City[i]))] < 25 &&
          count(jdata$City)$freq[which(count(jdata$City)$x == (jdata$City[i]))] > 10){
  jdata$Jobs_density[i] = "Medium"
} else {
  jdata$Jobs_density[i] = "Low"
}

```

Set up 2 subsets for North and South:

```{r}
North_sub = jdata[which(jdata$Region == "North CA"),]
head(North_sub,5)
South_sub = jdata[which(jdata$Region == "South CA"),]
head(South_sub,5)
```


Number of companies:

```{r}
n_companies_north = rep(0, length(count(North_sub$Company)$freq))
n_companies_south = rep(0, length(count(South_sub$Company)$freq))

for(i in 1:length(count(North_sub$Company)$freq)){
  if(count(North_sub$Company)$freq[i] == 1){
    n_companies_north[i] = count(North_sub$Company)$freq[i] 
  } else{
    n_companies_north[i] = 1
  }
}

for(i in 1:length(count(South_sub$Company)$freq)){
  if(count(South_sub$Company)$freq[i] == 1){
    n_companies_south[i] = count(South_sub$Company)$freq[i] 
  } else{
    n_companies_south[i] = 1
  }
}

sum(n_companies_north)
sum(n_companies_south)
```

Average minimum experience:

```{r}
avg_exp_N = round(mean(North_sub$Minimum_exp_years),2)
avg_exp_S = round(mean(South_sub$Minimum_exp_years),2)
avg_exp_N
avg_exp_S
```
 
Average salary:

```{r}
#Use NA.omit to omit to take out NA values then use mean function to find average
Omit_yr_salary_N = na.omit(North_sub$Estimate_minimum_average_salary)
Omit_yr_salary_S = na.omit(South_sub$Estimate_minimum_average_salary)
North_Est_min_salary = round(mean(Omit_yr_salary_N)/1000,2)
South_Est_min_salary = round(mean(Omit_yr_salary_S)/1000,2)

North_Est_min_salary
South_Est_min_salary
```

Setting up the dataframe for histogram:

```{r}
firstdf = data.frame(
          Region = rep(c("North", "South"), each = 3),
          Factor = rep(c(" Minimum exp", "Minimum estimate salary","Number Companies")),
          Number = c(avg_exp_N, North_Est_min_salary, sum(n_companies_north),
                     avg_exp_S, South_Est_min_salary, sum(n_companies_south)))

plotfirst = ggplot(data = firstdf, aes(x = Factor, y = Number, fill = Region)) + 
    geom_bar(stat = "identity", position=position_dodge()) +  
    geom_text(aes(label = Number), position = position_dodge(0.95), vjust=0.5, color = "darkred", size = 3)

#jpeg('plotfirst.jpg')
#plot(plotfirst)
plotfirst

```

Number of Bachelor's, Master's, Ph.D:

```{r}
#Nearly same as counting number of companies:
#Create 3 vectors: n_bach, n_master, n_phd to store the values.
#For this one we need to use stringr.
#Ex: All levels -> n_bach = n_bach + 1, n_master = n_master + 1, n_phd = n_phd + 1
#BS/MS ->  n_bach = n_bach + 1, n_master = n_master + 1 (Use  stringr so that we can get only BS or only MS)
count(jdata$Standing)
Standing_sub = jdata[which(jdata$Standing != "NA"),]
North_sub_st = Standing_sub[which(Standing_sub$Region == "North CA"),]
South_sub_st = Standing_sub[which(Standing_sub$Region == "South CA"),]
```

Testing string r:

```{r}

n_bach = length(str_subset(jdata$Standing, pattern = "^BS")) + count(jdata$Standing)$freq[which(count(jdata$Standing) == "All levels")]  
n_bach

n_master = length(str_subset(jdata$Standing, pattern = "^MS")) + length(str_subset(jdata$Standing, pattern = "MS$")) +  count(jdata$Standing)$freq[which(count(jdata$Standing) == "MBA")] + count(jdata$Standing)$freq[which(count(jdata$Standing) == "All levels")] - length(str_subset(jdata$Standing, pattern = "^MS$"))
n_master

n_PH.D = length(str_subset(jdata$standing, pattern = "^PH.D")) + length(str_subset(jdata$Standing, pattern = "PH.D$")) + count(jdata$Standing)$freq[which(count(jdata$Standing) == "All levels")]
n_PH.D
```

Create dataframe to plot out our histogram:


Plot a histogram to see the prefer language for both prefer language 1 and prefer language 2

```{r}
# Top five most demanding languages:C++, Java, Python,R,SQL

count(jdata$Preferred_lang1)
count(jdata$Preferred_lang2)

n_cpp = length(str_subset(jdata$Preferred_lang1, pattern = "^C\\++$")) 
       +length(str_subset(jdata$Preferred_lang2, pattern = "C\\++$"))
n_cpp

n_java = length(str_subset(jdata$Preferred_lang1, pattern = "^Java$")) 
        +length(str_subset(jdata$Preferred_lang2, pattern = "^Java$"))

n_java
n_Python = length(str_subset(jdata$Preferred_lang1, pattern = "^Python$")) 
          +length(str_subset(jdata$Preferred_lang2, pattern = "^Python$"))
n_Python

n_R = length(str_subset(jdata$Preferred_lang1, pattern = "^R$")) + 
     +length(str_subset(jdata$Preferred_lang2, pattern = "R$"))

n_R

n_SQL = length(str_subset(jdata$Preferred_lang1, pattern = "^SQL$")) 
       +length(str_subset(jdata$Preferred_lang1, pattern = "/SQL$")) 
       +length(str_subset(jdata$Preferred_lang2, pattern = "^SQL$"))

n_SQL
```

Write function to find out suitable companies: "find_company" that has 4 agrument. Minimum standing, experience, region, best language. It will return the dataframe that has all the company that fit our agruments

Linear regression:

```{r}
model = lm(Estimate_minimum_average_salary ~ Minimum_exp_years, data = jdata)
plot(jdata$Estimate_minimum_average_salary ~ jdata$Minimum_exp_years, main = "Experience vs Years", xlab = "Years", ylab = "Salary")
abline(model)
```

```{r}
jdata$Jobs_density[1]
count(jdata$Position)
```

Write a function to predict the salary base on Jobs_density, Position, Standing. Simulate it around 1000 times to make sure our function correct

```{r}
My_est_salary = function(Jobs_density, data){
  result = data$Estimate_minimum_average_salary[which.min(data$Estimate_minimum_average_salary)]
  if(Jobs_density == "High"){
    result = result * 2
  }  else if (Jobs_density == "Medium") {
    result = result * 1.5
  }  else{ result = result *  1.25}
  #if(Position == "Data Scientist" || Position == "Data Engineer")
  
  
  
  return (result)
}
```

```{r}
My_est_salary(jdata$Jobs_density[2], jdata) - jdata$Estimate_minimum_average_salary[2]
```