---
title: "Data Related jobs"
author: "Khuong Le & Shiyong Liu"
date: July 23, 2018
---

Load different packages that will use in this model:

```{r}
pkg_list = c("ggplot2", "plyr", "stringr")
mia_pkgs = pkg_list[!(pkg_list %in% installed.packages()[,"Package"])]
if(length(mia_pkgs) > 0) install.packages(mia_pkgs)
loaded_pkgs = lapply(pkg_list, require, character.only=TRUE)
```

Set up the data:

```{r}
jdata = read.csv("datarelatedjobs.csv")
names(jdata)
head(jdata)
```

Overiew about our dataset:

```{r}
summary(jdata)
str(data)
```

1. Comparing between companies in the North and the South of California (using side-by-side histogram):

- Number of companies in North vs South
- Average minimum experience. 
- Average salary in North vs South

Data transformation:

Minimum experience

```{r}
for(i in 1:length(jdata$Minimum_exp_years)){
  if(jdata$Minimum_exp_years[i] == 1 & !is.na(jdata$Estimate_minimum_average_salary[i])){
    if(jdata$Estimate_minimum_average_salary[i] >= 150000){
      jdata$Minimum_exp_years[i] = 4
    }
    else if(jdata$Estimate_minimum_average_salary[i] >= 130000 &
            jdata$Estimate_minimum_average_salary[i] <  150000){
      jdata$Minimum_exp_years[i] = 3
    }
    else if (jdata$Estimate_minimum_average_salary[i] >= 100000 &
             jdata$Estimate_minimum_average_salary[i] <  130000){
      jdata$Minimum_exp_years[i] = 2
    }
    else{jdata$Minimum_exp_years[i] = 1}
  } 
}
```

Add variable names: Jobs density to show which city offers lots of position, which city offers less position.

```{r}
set.seed(2018)
result = jdata$Estimate_minimum_average_salary[which.min(jdata$Estimate_minimum_average_salary)]
for (i in 1:length(jdata$City))
if(count(jdata$City)$freq[which(count(jdata$City)$x == (jdata$City[i]))] > mean(count(jdata$City)$freq)){ 
  jdata$Jobs_density[i] = "High"
  jdata$City_Bonus[i] = round(rnorm(1, mean = result * 1.75, sd = 500),1) 
} else {
  jdata$Jobs_density[i] = "Low"
  jdata$City_Bonus[i] = round(rnorm(1, mean = result* 1.25, sd = 500),1) 
}

```

Set up bonuses for salary:
```{r}
count(jdata$City)
count(str_detect(jdata$Position, pattern = "Scientist"))
count(str_detect(jdata$Position, pattern = "Analyst"))
count(str_detect(jdata$Position, pattern = "Engineer"))
```

According to job function, we can divide position into 3 functions (Engineer, Scientist, Analyst). Assume bonuses follow a normal distribution that has mean = 7000 - 6000 - 5000 and sd = 500

```{r}
set.seed(2018)
for (i in 1:length(jdata$Position)){
  if(str_detect(jdata$Position[i], pattern = "Engineer")){
    jdata$Posi_Bonus[i] = round(rnorm(1, mean = 7000, sd = 500),1)
  }  else if (str_detect(jdata$Position[i], pattern = "Scientist")){
    jdata$Posi_Bonus[i] = round(rnorm(1, mean = 5000, sd = 500),1)
  }  else if (str_detect(jdata$Position[i], pattern = "Analyst")){
    jdata$Posi_Bonus[i] = round(rnorm(1, mean = 3000, sd = 500),1)
  } 
}
#as.numeric(jdata$Posi_Bonus)
```

Complete the data:

```{r}
jdata$X = NULL
jdata
```

Set up 2 subsets for North and South:

```{r}
North_sub = jdata[which(jdata$Region == "North CA"),]
head(North_sub,5)
South_sub = jdata[which(jdata$Region == "South CA"),]
head(South_sub,5)
```


Number of companies:

```{r}
n_companies_north = rep(0, length(count(North_sub$Company)$freq))
n_companies_south = rep(0, length(count(South_sub$Company)$freq))

for(i in 1:length(count(North_sub$Company)$freq)){
  if(count(North_sub$Company)$freq[i] == 1){
    n_companies_north[i] = count(North_sub$Company)$freq[i] 
  } else{
    n_companies_north[i] = 1
  }
}

for(i in 1:length(count(South_sub$Company)$freq)){
  if(count(South_sub$Company)$freq[i] == 1){
    n_companies_south[i] = count(South_sub$Company)$freq[i] 
  } else{
    n_companies_south[i] = 1
  }
}
sum(n_companies_north)
sum(n_companies_south)
```

Average minimum experience:

```{r}
avg_exp_N = round(mean(North_sub$Minimum_exp_years)*12,0)
avg_exp_S = round(mean(South_sub$Minimum_exp_years)*12,0)
avg_exp_N
avg_exp_S
```
 
Average salary:

```{r}
#Use NA.omit to omit to take out NA values then use mean function to find average
Omit_yr_salary_N = na.omit(North_sub$Estimate_minimum_average_salary)
Omit_yr_salary_S = na.omit(South_sub$Estimate_minimum_average_salary)
North_Est_min_salary = round(mean(Omit_yr_salary_N)/1000,2)
South_Est_min_salary = round(mean(Omit_yr_salary_S)/1000,2)

North_Est_min_salary
South_Est_min_salary
```

Setting up the dataframe for histogram:

```{r}
firstdf = data.frame(
          Region = rep(c("North", "South"), each = 3),
          Factor = rep(c("Average experience (in months)", "Average salary (in thousands)","Number Companies")),
          Number = c(avg_exp_N, North_Est_min_salary, sum(n_companies_north),
                     avg_exp_S, South_Est_min_salary, sum(n_companies_south)))

plotfirst = ggplot(data = firstdf, aes(x = Factor, y = Number, fill = Region)) + 
    geom_bar(stat = "identity", position=position_dodge()) +  
    geom_text(aes(label = Number), position = position_dodge(0.95), vjust=0.5, color = "darkred", size = 3)

#jpeg('plotfirst.jpg')
#plot(plotfirst)
plotfirst

```

2. Comparing between companies in the North and the South of California (using side-by-side histogram):
- Number of Bachelor's, Master's, Ph.D that companies recruiting in North vs South. (All levels = add 1 to every value)
- Top 5 most used languages.

```{r}
#Nearly same as counting number of companies:
#Create 3 vectors: n_bach, n_master, n_phd to store the values.
#For this one we need to use stringr.
#Ex: All levels -> n_bach = n_bach + 1, n_master = n_master + 1, n_phd = n_phd + 1
#BS/MS ->  n_bach = n_bach + 1, n_master = n_master + 1 (Use  stringr so that we can get only BS or only MS)
Standing_sub = jdata[which(jdata$Standing != "NA"),]
North_sub_st = Standing_sub[which(Standing_sub$Region == "North CA"),]
South_sub_st = Standing_sub[which(Standing_sub$Region == "South CA"),]
```

String numbers of standing North:

Overivew:
```{r}
count(North_sub_st$Standing)
```
Details:

String R, numbers of standing South:

```{r}
n_bach_S = length(str_subset(South_sub_st$Standing, pattern = "^B")) + count(South_sub_st$Standing)$freq[which(count(South_sub_st$Standing) == "All levels")]  
n_bach_S

n_master_S = length(str_subset(South_sub_st$Standing, pattern = "^MS")) + length(str_subset(South_sub_st$Standing, pattern = "MS$")) + count(South_sub_st$Standing)$freq[which(count(South_sub_st$Standing) == "All levels")] - length(str_subset(South_sub_st$Standing, pattern = "^MS$"))
n_master_S

n_PH.D_S = length(str_subset(South_sub_st$standing, pattern = "^PH.D")) + length(str_subset(South_sub_st$Standing, pattern = "PH.D$")) + count(South_sub_st$Standing)$freq[which(count(South_sub_st$Standing) == "All levels")]
n_PH.D_S
```

String R, numbers of standing North:

```{r}
n_bach_N = length(str_subset(North_sub_st$Standing, pattern = "^B")) + count(North_sub_st$Standing)$freq[which(count(North_sub_st$Standing) == "All levels")]  
n_bach_N

n_master_N = length(str_subset(North_sub_st$Standing, pattern = "^MS")) + length(str_subset(North_sub_st$Standing, pattern = "MS$")) + count(North_sub_st$Standing)$freq[which(count(North_sub_st$Standing) == "All levels")] - length(str_subset(North_sub_st$Standing, pattern = "^MS$"))
n_master_N

n_PH.D_N = length(str_subset(North_sub_st$standing, pattern = "^PH.D")) + length(str_subset(North_sub_st$Standing, pattern = "PH.D$")) + count(North_sub_st$Standing)$freq[which(count(North_sub_st$Standing) == "All levels")]
n_PH.D_N
```

Create dataframe to plot out our histogram:

```{r}
secondtdf = data.frame(
          Region = rep(c("North", "South"), each = 3),
          Factor = rep(c("Bachelor degree", "Master degree","PH.D")),
          Number = c(n_bach_N, n_master_N, n_PH.D_N,
                     n_bach_S, n_master_S, n_PH.D_S))

plotsecond = ggplot(data = secondtdf, aes(x = Factor, y = Number, fill = Region)) + 
    geom_bar(stat = "identity", position=position_dodge()) +  
    geom_text(aes(label = Number), position = position_dodge(0.95), vjust=0.5, color = "darkred", size = 3)

#jpeg('plotsecond.jpg')
#plot(plotsecond)
plotsecond
```


Plot a histogram to see the prefer language for both prefer language 1 and prefer language 2

```{r}
count(jdata$Preferred_lang1)[order(count(jdata$Preferred_lang1)$freq),] 
count(jdata$Preferred_lang2)
```

Write function to count and put them in decreasing order:

Intputs: 2 columns that needs to be counted
Output: Dataframe in order of your choice (decreasing/ increasing)

```{r}
count_order = function(col1, col2, order, top){
  ct1 = count(col1)
  ct2 = count(col2)
  for(i in 1:length(ct2)){
    for(k in 1:length(ct1)){
      if(col2$x[i] == col1[k]){
        col1$freq[k] = col1$freq[k] + 1
      }
    }
  }
  if(order == "increasing"){
    ct1_pre = ct1[order(ct1$freq, decreasing = T),]
    fresult  = data.frame(Faction1 = ct1_pre$x,
                          Freqq1   = ct1_pre$freq)
                          
  }
  return(head(fresult,top))
}

count_order(South_sub_st$Preferred_lang1, South_sub_st$Preferred_lang2,"increasing", 10)
```


```{r}
ct1 = count(South_sub_st$Preferred_lang1)
ct2 = count(South_sub_st$Preferred_lang2)
  
ct1
ct2
```



```{r}
# Top five most demanding languages:C++, Java, Python,R,SQL

<<<<<<< HEAD
order_lang_S = count(South_sub_st$Preferred_lang1)
order_lang_N = count(North_sub_st$Preferred_lang1)
OLS = order_lang_S[order(order_lang_S$freq, decreasing = TRUE),]
OLN = order_lang_N[order(order_lang_N$freq, decreasing = TRUE),]
OLS_df = data.frame(Name_language = OLS$x, Freq = OLS$freq)
OLN_df = data.frame(Name_language = OLN$x, Freq = OLN$freq)

head(OLS_df, 5)
head(OLN_df, 5)
```

=======
count(South_sub_st$Preferred_lang1)
count(North_sub_st$Preferred_lang2)
>>>>>>> 7ef5007b8e20be982e912159ba0ae14042dc250f

```{r}
n_cpp_North = length(str_subset(North_sub_st$Preferred_lang1, pattern = "^C\\++$")) +length(str_subset(North_sub_st$Preferred_lang2, pattern = "C\\++$"))

n_cpp_North

n_cpp_South = length(str_subset(South_sub_st$Preferred_lang1, pattern = "^C\\++$")) +length(str_subset(South_sub_st$Preferred_lang2, pattern = "C\\++$"))
n_cpp_South

n_java_South = length(str_subset(South_sub_st$Preferred_lang1, pattern = "^Java$")) +length(str_subset(South_sub_st$Preferred_lang2, pattern = "^Java$"))

n_java_South

n_java_North = length(str_subset(North_sub_st$Preferred_lang1, pattern = "^Java$")) +length(str_subset(North_sub_st$Preferred_lang2, pattern = "^Java$"))

n_java_North

n_Python_North = length(str_subset(North_sub_st$Preferred_lang1, pattern = "^Python$"))+length(str_subset(North_sub_st$Preferred_lang2, pattern = "^Python$"))

n_Python_North

n_Python_South = length(str_subset(South_sub_st$Preferred_lang1, pattern = "^Python$"))  +length(str_subset(South_sub_st$Preferred_lang2, pattern ="^Python$"))

n_Python_South

n_R_North = length(str_subset(North_sub_st$Preferred_lang1, pattern = "^R$")) +length(str_subset(North_sub_st$Preferred_lang2, pattern = "R$"))

n_R_North

n_R_South = length(str_subset(South_sub_st$Preferred_lang1, pattern = "^R$"))  +length(str_subset(South_sub_st$Preferred_lang2, pattern = "R$"))

n_R_South

n_SQL_North = length(str_subset(North_sub_st$Preferred_lang1, pattern = "^SQL$")) +length(str_subset(North_sub_st$Preferred_lang1, pattern = "/SQL$")) +length(str_subset(North_sub_st$Preferred_lang2, pattern = "^SQL$"))

n_SQL_North

n_SQL_South = length(str_subset(South_sub_st$Preferred_lang1, pattern = "^SQL$"))+ length(str_subset(South_sub_st$Preferred_lang1, pattern = "/SQL$"))+ length(str_subset(South_sub_st$Preferred_lang2, pattern = "^SQL$"))

n_SQL_South

```

Write function to find out suitable companies: "find_company" that has 4 agrument. Minimum standing, experience, region, best language. It will return the dataframe that has all the company that fit our agruments


```{r}
# Names of Companies that satisfy the conditions
find_company = function(preferred_Language,Minimum_Experience,Region){
  preferred_Language = c("Python","C++","Java","R","SQL")
   x = jdata$Company[which(jdata$Preferred_lang1 ==   preferred_Language)]
   Minimum_Experience = seq(20)
   y = jdata$Company[which(jdata$Minimum_exp_years == Minimum_Experience)]
   Region = c("North CA", "South CA")
   z = jdata$Company[which(jdata$Region == Region)]

return(list(x,y,z))
  
}

find_company(Python,2,NorthCA)

```


```{r}
jdata$City

rep(NA,600)

list(x,y,z)
```

```{r}


rep(0,length(jdata$Region == ""))
rep(0,length(jdata$Minimum_exp_years == "1")

n_companies_north = rep(0, length(count(North_sub$Company)$freq))


```


```{r}
count(jdata$Minimum_exp_years)
length(jdata$Preferred_lang1 = "Python")
```


Linear regression:

```{r}
model = lm(Estimate_minimum_average_salary ~ Posi_Bonus, data = jdata)
plot(jdata$Estimate_minimum_average_salary ~ jdata$Posi_Bonus
, main = "Experience vs Years", xlab = "Years", ylab = "Salary")
abline(model)
```

```{r}
jdata$Jobs_density[1]
count(jdata$Position)
```

Write a function to predict the salary base on Jobs_density, Position, Standing. Simulate it around 1000 times to make sure our function correct


```{r}
My_est_salary(jdata$Jobs_density[2], jdata) - jdata$Estimate_minimum_average_salary[2]
```